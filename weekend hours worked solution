WITH hours_worked AS (
    SELECT
        emp_id,
        CASE 
            WHEN EXTRACT(MINUTE FROM TIMESTAMP) >= EXTRACT(MINUTE FROM lag(TIMESTAMP) OVER(PARTITION BY CAST(TIMESTAMP AS DATE), emp_id ORDER BY TIMESTAMP)) THEN EXTRACT(HOUR FROM TIMESTAMP) - EXTRACT(HOUR FROM lag(TIMESTAMP) OVER(PARTITION BY CAST(TIMESTAMP AS DATE), emp_id ORDER BY TIMESTAMP)) 
            ELSE EXTRACT(HOUR FROM TIMESTAMP) - EXTRACT(HOUR FROM lag(TIMESTAMP) OVER(PARTITION BY CAST(TIMESTAMP AS DATE), emp_id ORDER BY TIMESTAMP)) - 1
        END AS hours_worked
    FROM attendance
    WHERE DAYOFWEEK(TIMESTAMP) IN (1, 7) -- Filtering weekends
)
SELECT
    emp_id,
    SUM(hours_worked) AS hours_worked
FROM hours_worked
GROUP BY emp_id
ORDER BY hours_worked DESC;
